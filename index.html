<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gupy Frases - Painel Administrativo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* Ajustes finos de scrollbar e fontes */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .active-nav { background-color: #eff6ff; color: #2563eb; border-right: 3px solid #2563eb; }
        
        /* Scrollbar personalizada sutil */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Anima√ß√µes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body class="h-screen flex overflow-hidden text-slate-600">

    <aside class="w-64 bg-white border-r border-slate-200 flex flex-col z-20 hidden md:flex">
        <div class="h-16 flex items-center px-6 border-b border-slate-100">
            <div class="font-black text-xl text-blue-600 tracking-tight">
                <i class="fas fa-quote-right mr-2"></i>Gupy<span class="text-slate-700">Frases</span>
            </div>
        </div>

        <nav class="flex-1 py-6 space-y-1 overflow-y-auto">
            <button onclick="navegarPara('dashboard')" id="nav-dashboard" class="w-full flex items-center px-6 py-3 text-sm font-bold text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition group active-nav">
                <i class="fas fa-chart-pie w-6 text-lg group-hover:scale-110 transition"></i>
                Dashboard
            </button>
            
            <button onclick="navegarPara('frases')" id="nav-frases" class="w-full flex items-center px-6 py-3 text-sm font-bold text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition group">
                <i class="fas fa-list-alt w-6 text-lg group-hover:scale-110 transition"></i>
                Gerenciar Frases
            </button>
            
            <button onclick="navegarPara('equipe')" id="nav-equipe" class="w-full flex items-center px-6 py-3 text-sm font-bold text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition group">
                <i class="fas fa-users w-6 text-lg group-hover:scale-110 transition"></i>
                Equipe
                <span id="contador-equipe" class="hidden ml-auto bg-blue-100 text-blue-600 py-0.5 px-2 rounded-full text-[10px]">0</span>
            </button>

            <button onclick="navegarPara('logs')" id="nav-logs" class="w-full flex items-center px-6 py-3 text-sm font-bold text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition group">
                <i class="fas fa-history w-6 text-lg group-hover:scale-110 transition"></i>
                Atividades
            </button>
        </nav>

        <div class="p-4 border-t border-slate-100">
            <div class="flex items-center gap-3 mb-4 px-2">
                <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs" id="avatar-user">U</div>
                <div>
                    <p class="text-xs font-bold text-slate-700 truncate w-24" id="nome-usuario-logado">Carregando...</p>
                    <p class="text-[10px] text-slate-400">Online</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full py-2 border border-slate-200 rounded-lg text-xs font-bold text-slate-500 hover:bg-red-50 hover:text-red-500 hover:border-red-200 transition">
                <i class="fas fa-sign-out-alt mr-1"></i> Sair
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        
        <header class="h-16 bg-white border-b border-slate-200 flex justify-between items-center px-6 shrink-0">
            <h1 class="font-extrabold text-slate-700 text-lg" id="titulo-pagina">Vis√£o Geral</h1>
            
            <div class="hidden md:flex items-center bg-slate-100 rounded-lg px-3 py-1.5 w-64 border border-transparent focus-within:border-blue-300 focus-within:bg-white transition">
                <i class="fas fa-search text-slate-400 text-xs"></i>
                <input type="text" id="global-search" onkeyup="aplicarFiltrosGlobal()" placeholder="Buscar..." class="bg-transparent border-none outline-none text-xs font-bold text-slate-600 ml-2 w-full placeholder:font-normal">
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-6 bg-slate-50/50" id="main-scroll">
            
            <div id="view-login" class="fixed inset-0 bg-slate-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm text-center border border-slate-100">
                    <div class="mb-6 inline-block p-4 rounded-full bg-blue-50 text-blue-600 text-3xl">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="text-xl font-extrabold text-slate-800 mb-1">Acesso Restrito</h2>
                    <p class="text-sm text-slate-400 mb-6">Entre com suas credenciais.</p>
                    
                    <form onsubmit="event.preventDefault(); fazerLogin();" class="space-y-4">
                        <input type="text" id="login-user" placeholder="Usu√°rio" class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition">
                        <input type="password" id="login-pass" placeholder="Senha" class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition">
                        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 hover:shadow-lg hover:shadow-blue-500/30 transition transform active:scale-95">
                            Entrar
                        </button>
                    </form>
                </div>
            </div>

            <div id="view-dashboard" class="space-y-6 animate-fade-in hidden">
                
                <div id="painel-dashboard" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Total Intera√ß√µes</p>
                                    <p class="text-2xl font-black text-blue-600 mt-1" id="kpi-total-usos">0</p>
                                </div>
                                <div class="bg-blue-50 text-blue-500 p-2 rounded-lg text-lg"><i class="fas fa-chart-line"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Frases Ativas</p>
                                    <p class="text-2xl font-black text-slate-700 mt-1" id="kpi-frases-ativas">0</p>
                                </div>
                                <div class="bg-slate-100 text-slate-500 p-2 rounded-lg text-lg"><i class="fas fa-database"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Inativas (90d)</p>
                                    <div id="contador-sem-uso" class="text-2xl font-black text-green-500 mt-1">0</div>
                                </div>
                                <div class="bg-orange-50 text-orange-500 p-2 rounded-lg text-lg"><i class="fas fa-stopwatch"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Membros</p>
                                    <p class="text-2xl font-black text-purple-600 mt-1" id="kpi-total-users">0</p>
                                </div>
                                <div class="bg-purple-50 text-purple-500 p-2 rounded-lg text-lg"><i class="fas fa-users"></i></div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                            <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex justify-between items-center">
                                <h3 class="font-bold text-slate-700 text-sm"><i class="fas fa-trophy mr-2 text-yellow-500"></i>Top 5 Mais Ativos</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left"><tbody id="lista-top-users"></tbody></table>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                            <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex justify-between items-center">
                                <h3 class="font-bold text-slate-700 text-sm"><i class="fas fa-user-clock mr-2 text-slate-400"></i>Top 5 Menos Ativos</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left"><tbody id="lista-bottom-users"></tbody></table>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                            <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50">
                                <h3 class="font-bold text-slate-700 text-sm"><i class="fas fa-fire mr-2 text-red-500"></i>Frases Mais Utilizadas</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left"><tbody id="lista-top-frases"></tbody></table>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                            <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50">
                                <h3 class="font-bold text-slate-700 text-sm" title="Frases com pelo menos 10 usos"><i class="fas fa-battery-quarter mr-2 text-orange-400"></i>Frases Menos Usadas (+10 usos)</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left"><tbody id="lista-low-frases"></tbody></table>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-slate-50 bg-red-50/30 flex justify-between items-center">
                            <h3 class="font-bold text-red-700 text-sm"><i class="fas fa-archive mr-2"></i>Zona de Esquecimento (Sem uso h√° 90+ dias)</h3>
                        </div>
                        <div class="overflow-x-auto max-h-96 custom-scrollbar">
                            <table class="w-full text-left"><tbody id="lista-frases-sem-uso"></tbody></table>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="view-frases" class="hidden animate-fade-in space-y-4">
                <div class="flex flex-wrap justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100 gap-4">
                    <div class="flex gap-2 w-full md:w-auto">
                        <select id="filtro-empresa" onchange="aplicarFiltros('empresa')" class="text-xs border rounded px-2 py-1.5 bg-slate-50 outline-none focus:border-blue-500"><option value="">üè¢ Empresas</option></select>
                        <select id="filtro-motivo" onchange="aplicarFiltros('motivo')" class="text-xs border rounded px-2 py-1.5 bg-slate-50 outline-none focus:border-blue-500"><option value="">üéØ Motivos</option></select>
                        <select id="filtro-doc" onchange="aplicarFiltros('doc')" class="text-xs border rounded px-2 py-1.5 bg-slate-50 outline-none focus:border-blue-500"><option value="">üìÑ Docs</option></select>
                        <button onclick="limparFiltros()" class="text-slate-400 hover:text-slate-600 px-2" title="Limpar Filtros"><i class="fas fa-times"></i></button>
                    </div>

                    <div class="flex gap-2">
                         <input type="file" id="input-import-sheet" class="hidden" accept=".xlsx, .xls" onchange="processarArquivoFrases(this)">
                         <button onclick="importarPlanilhaFrases()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-green-700 transition shadow-sm"><i class="fas fa-file-excel mr-2"></i>Importar</button>
                         <button onclick="abrirModalCriarFrase()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-blue-700 transition shadow-sm"><i class="fas fa-plus mr-2"></i>Nova</button>
                    </div>
                </div>
                
                <div id="grid-frases" class="grid grid-cols-1 gap-4">
                    <p class="text-center text-slate-400 p-10">Carregando biblioteca...</p>
                </div>
            </div>

            <div id="view-equipe" class="hidden animate-fade-in space-y-4">
                 <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="font-bold text-slate-700">Gest√£o de Membros</h2>
                        <button onclick="abrirModalUsuario()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-blue-700"><i class="fas fa-user-plus mr-2"></i>Novo Membro</button>
                    </div>
                    <div id="lista-equipe-container"></div>
                </div>
            </div>

            <div id="view-logs" class="hidden animate-fade-in space-y-4">
                </div>

        </div>
    </main>

    <div id="modal-usuario" class="fixed inset-0 bg-slate-900/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 id="modal-user-title" class="text-lg font-bold text-slate-700 mb-4">Novo Membro</h3>
            <input type="hidden" id="id-user-edit">
            <div class="space-y-3">
                <input id="nome-novo" type="text" placeholder="Nome Completo" class="w-full px-4 py-2 rounded bg-slate-50 border border-slate-200 text-sm outline-none focus:border-blue-500">
                <input id="user-novo" type="text" placeholder="Login (ID)" class="w-full px-4 py-2 rounded bg-slate-50 border border-slate-200 text-sm outline-none focus:border-blue-500">
                <input id="pass-novo" type="text" placeholder="Senha" class="w-full px-4 py-2 rounded bg-slate-50 border border-slate-200 text-sm outline-none focus:border-blue-500">
                <select id="perfil-novo" class="w-full px-4 py-2 rounded bg-slate-50 border border-slate-200 text-sm outline-none focus:border-blue-500">
                    <option value="user">Colaborador</option>
                    <option value="admin">Administrador</option>
                </select>
                <div class="flex items-center gap-2 mt-2">
                    <input type="checkbox" id="ativo-novo" class="w-4 h-4 text-blue-600 rounded cursor-pointer">
                    <label for="ativo-novo" class="text-sm text-slate-600 font-bold cursor-pointer">Usu√°rio Ativo</label>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-2">
                <button onclick="fecharModalUsuario()" class="px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-50 rounded">Cancelar</button>
                <button onclick="salvarUsuario()" id="btn-salvar-user" class="px-4 py-2 text-sm font-bold bg-blue-600 text-white rounded hover:bg-blue-700 shadow-lg shadow-blue-500/30">Salvar</button>
            </div>
        </div>
    </div>

    <div id="modal-frase" class="fixed inset-0 bg-slate-900/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6">
            <h3 id="modal-title" class="text-lg font-bold text-slate-700 mb-4">Editar Frase</h3>
            <input type="hidden" id="id-frase">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <input id="inp-empresa" placeholder="Empresa" class="px-3 py-2 border rounded text-sm bg-slate-50 outline-none focus:border-blue-500">
                <input id="inp-motivo" placeholder="Motivo" class="px-3 py-2 border rounded text-sm bg-slate-50 outline-none focus:border-blue-500">
            </div>
            <input id="inp-doc" placeholder="Documento" class="w-full px-3 py-2 border rounded text-sm bg-slate-50 mb-3 outline-none focus:border-blue-500">
            <textarea id="inp-conteudo" rows="4" placeholder="Conte√∫do da frase..." class="w-full px-3 py-2 border rounded text-sm bg-slate-50 mb-4 outline-none focus:border-blue-500"></textarea>
            
            <div class="flex justify-end gap-2">
                <button onclick="document.getElementById('modal-frase').classList.add('hidden')" class="px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded">Cancelar</button>
                <button onclick="salvarFrase()" class="px-4 py-2 text-sm font-bold bg-blue-600 text-white rounded hover:bg-blue-700 shadow-md">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO SUPABASE ---
        // IMPORTANTE: Insira suas credenciais reais aqui
        const SUPABASE_URL = 'SUA_URL_SUPABASE_AQUI'; 
        const SUPABASE_KEY = 'SUA_KEY_SUPABASE_AQUI';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let usuarioLogado = null;

        // Sistema de Navega√ß√£o
        function navegarPara(viewId) {
            // Esconde todas as views
            ['view-dashboard', 'view-frases', 'view-equipe', 'view-logs'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            // Mostra a desejada
            document.getElementById('view-' + viewId).classList.remove('hidden');
            
            // Atualiza T√≠tulo e Menu Ativo
            const titulos = {
                'dashboard': 'Dashboard Geral',
                'frases': 'Gerenciador de Frases',
                'equipe': 'Membros da Equipe',
                'logs': 'Registro de Atividades'
            };
            document.getElementById('titulo-pagina').innerText = titulos[viewId] || 'Gupy Frases';

            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active-nav'));
            const btnAtivo = document.getElementById('nav-' + viewId);
            if(btnAtivo) btnAtivo.classList.add('active-nav');

            // Dispara carregamentos
            if(viewId === 'dashboard') carregarDashboard();
            if(viewId === 'equipe') carregarEquipe();
            if(viewId === 'logs') carregarLogs();
            if(viewId === 'frases') carregarFrases();
        }

        // Login
        async function fazerLogin() {
            const user = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;

            try {
                const { data, error } = await _supabase
                    .from('usuarios')
                    .select('*')
                    .eq('username', user)
                    .eq('senha', pass)
                    .single();

                if (error || !data) throw new Error();
                if (!data.ativo) return Swal.fire('Acesso Negado', 'Usu√°rio inativo.', 'error');

                usuarioLogado = data;
                document.getElementById('nome-usuario-logado').innerText = data.nome || data.username;
                document.getElementById('avatar-user').innerText = (data.nome || data.username).charAt(0).toUpperCase();
                
                document.getElementById('view-login').classList.add('hidden');
                
                // Redireciona
                if(data.perfil === 'admin') navegarPara('dashboard');
                else {
                    document.getElementById('nav-dashboard').classList.add('hidden');
                    navegarPara('frases');
                }
                
                // Grava log
                registrarLog('LOGIN', 'Acesso realizado');

            } catch (e) {
                Swal.fire('Erro', 'Credenciais inv√°lidas', 'error');
            }
        }

        function logout() {
            usuarioLogado = null;
            document.getElementById('view-login').classList.remove('hidden');
        }

        // Fun√ß√£o auxiliar para logs
        async function registrarLog(acao, detalhe) {
            if(!usuarioLogado) return;
            await _supabase.from('logs').insert([{
                usuario: usuarioLogado.username,
                acao: acao,
                detalhe: detalhe,
                data_hora: new Date().toISOString()
            }]);
        }
        
        // Filtro Global na barra superior (conecta com a fun√ß√£o de filtro da biblioteca)
        function aplicarFiltrosGlobal() {
            // Se estiver na view de frases, usa o filtro da biblioteca
            if(!document.getElementById('view-frases').classList.contains('hidden') && typeof aplicarFiltros === 'function') {
                aplicarFiltros('global');
            }
            // (Opcional) Poderia filtrar logs ou equipe aqui tamb√©m se desejado
        }
    </script>

    <script src="js/biblioteca.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/logs.js"></script>
    <script src="js/equipe.js"></script>

</body>
</html>
